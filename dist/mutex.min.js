/*! mutexjs v1.1.0, created by: Jason Holt Smith <bicarbon8@gmail.com> 2015-02-07 16:24:56 */

var MutexJs={RETRY_MS:10,Semaphore:{_locks:[],_pruning:!1,_lock:function(a,b,c,d){"use strict";this.id=a,this.name=b,this.expiresAt=c,this.expirationCallback=d},get:function(a,b,c){"use strict";MutexJs.Semaphore._beginPruning();var d=null,e=!1,f=MutexJs.Semaphore._get(a);if(b&&(d=(new Date).getTime()+b),f||(e=!0),e){var g=MutexJs.Semaphore._guid();return MutexJs.Semaphore._locks.push(new MutexJs.Semaphore._lock(g,a,d,c)),g}return null},release:function(a){"use strict";MutexJs.Semaphore._locks=MutexJs.Semaphore._locks.filter(function(b){return b.id!==a})},_get:function(a){"use strict";for(var b in MutexJs.Semaphore._locks)if(MutexJs.Semaphore._locks[b].name===a)return MutexJs.Semaphore._locks[b];return null},_guid:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},_beginPruning:function(){MutexJs.Semaphore._pruning||(MutexJs.Semaphore._pruning=!0,MutexJs.Semaphore._pruneExpired())},_pruneExpired:function(){MutexJs.Semaphore._locks.forEach(function(a){a.expiresAt&&a.expiresAt<(new Date).getTime()&&(MutexJs.Semaphore.release(a.id),a.expirationCallback&&a.expirationCallback.call(this,a))}),setTimeout(function(){MutexJs.Semaphore._pruneExpired()},10)}},lock:function(a,b,c,d){"use strict";var e=-1;c&&"number"==typeof c&&(e=(new Date).getTime()+c),MutexJs._get(a,b,d,e,void 0,void 0)},lockFor:function(a,b,c,d){"use strict";MutexJs._get(a,b,function(){},-1,c,d)},release:function(a){"use strict";MutexJs.Semaphore.release(a)},_get:function(a,b,c,d,e,f){"use strict";var g=MutexJs.Semaphore.get(a,e,f);if(g)b(g);else if(-1===d||(new Date).getTime()+MutexJs.RETRY_MS<d)setTimeout(function(){MutexJs._get(a,b,c,d,e)},MutexJs.RETRY_MS);else{var h="unable to acquire lock for: "+a;if(!c)throw h;c(h)}}},module=module||{};module.exports=MutexJs;
//# sourceMappingURL=mutex.min.js.map