/*! mutexjs v1.1.2, created by: Jason Holt Smith <bicarbon8@gmail.com> 2015-02-10 14:16:38 */

var MutexJs={RETRY_MS:10,_queues:{},_running:!1,Semaphore:{_locks:[],_pruning:!1,_lock:function(a,b,c,d){"use strict";this.id=a,this.name=b,this.expiresAt=c,this.expirationCallback=d},get:function(a,b,c){"use strict";var d=null,e=!1,f=MutexJs.Semaphore._get(a);if(b&&(d=(new Date).getTime()+b),f||(e=!0),e){var g=MutexJs.Semaphore._guid();return MutexJs.Semaphore._locks.push(new MutexJs.Semaphore._lock(g,a,d,c)),MutexJs.Semaphore._beginPruning(),g}return null},release:function(a){"use strict";MutexJs.Semaphore._locks=MutexJs.Semaphore._locks.filter(function(b){return b.id!==a})},_get:function(a){"use strict";for(var b in MutexJs.Semaphore._locks)if(MutexJs.Semaphore._locks[b].name===a)return MutexJs.Semaphore._locks[b];return null},_guid:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},_beginPruning:function(){MutexJs.Semaphore._pruning||(MutexJs.Semaphore._pruning=!0,MutexJs.Semaphore._pruneExpired())},_pruneExpired:function(){MutexJs.Semaphore._pruning&&(MutexJs.Semaphore._locks.forEach(function(a){a.expiresAt&&a.expiresAt<(new Date).getTime()&&(MutexJs.Semaphore.release(a.id),a.expirationCallback&&a.expirationCallback.call(this,a))}),MutexJs.Semaphore._locks.length>0?setTimeout(function(){MutexJs.Semaphore._pruneExpired()},MutexJs.RETRY_MS):MutexJs.Semaphore._pruning=!1)},_reset:function(){MutexJs.Semaphore._pruning=!1,MutexJs.Semaphore._locks=[]}},queable:function(a,b,c,d,e,f){var g={name:a,fn:b,wait:d,onTimeout:c,duration:e,onExpired:f};return g},lock:function(a,b,c,d){"use strict";var e=-1;c&&"number"==typeof c&&(e=(new Date).getTime()+c);var f=MutexJs.queable(a,b,d,e,void 0,void 0);MutexJs._queueItem(f)},lockFor:function(a,b,c,d){"use strict";var e=MutexJs.queable(a,b,function(){},-1,c,d);MutexJs._queueItem(e)},release:function(a){"use strict";MutexJs.Semaphore.release(a)},_queueItem:function(a){setTimeout(function(){MutexJs._queues[a.name]||(MutexJs._queues[a.name]=[]),MutexJs._queues[a.name].push(a),MutexJs._running||(MutexJs._running=!0,MutexJs._run())},1)},_run:function(){"use strict";var a=!1;for(var b in MutexJs._queues){a=!0;var c=MutexJs._queues[b];if(c.length>0){var d=c[0];if(-1===d.wait||(new Date).getTime()<d.wait){var e=MutexJs.Semaphore.get(d.name,d.duration,d.onExpired);e&&(c.shift(),d.fn(e))}else{c.shift();var f="unable to acquire lock for: "+d.name;if(!d.onTimeout)throw f;d.onTimeout(f)}}else delete MutexJs._queues[b]}MutexJs._running&&a?setTimeout(function(){MutexJs._run()},MutexJs.RETRY_MS):MutexJs._running=!1},_reset:function(){MutexJs._running=!1,MutexJs._queues={},MutexJs.Semaphore._reset()}},module=module||{};module.exports=MutexJs;
//# sourceMappingURL=mutex.min.js.map